# 广告集成指南

## 概述

GrowthSDK 提供完整的广告集成解决方案，支持激励视频广告、插屏广告和开屏广告等多种广告格式。

## 支持的广告格式
## Podfile 集成（广告模块）

按需在 Podfile 中选择广告网络子模块：

```ruby
target 'YourAppTarget' do
  # 方式一：一键集成推荐广告网络（最简单）
  pod 'GrowthSDK/Recommended', '~> 1.0.0'
  
  # 方式二：自定义选择广告网络
  # pod 'GrowthSDK', '~> 1.0.0', :subspecs => ['Google', 'UnityAds', 'Vungle']

  # 方式三：单独指定子模块（自动依赖 Core）
  # pod 'GrowthSDK/Google', '~> 1.0.0'
  # pod 'GrowthSDK/UnityAds', '~> 1.0.0'
  # pod 'GrowthSDK/Vungle', '~> 1.0.0'
end
```

> 小贴士：
> - `GrowthSDK/Recommended` 包含 10 个主流广告网络，适合快速开始
> - 不同网络的初始化细节与额外配置请参考各自的集成说明与 AppLovin MAX 文档


### 广告样式枚举

```swift
@objc enum ADStyle: Int {
    case rewarded = 0   // 激励广告
    case inserted = 1   // 插屏广告
    case appOpen = 2    // 开屏广告
}
```

## 基本广告展示

### 简单展示

```swift
// 展示激励广告（无回调）
GrowthKit.showAd(with: .rewarded)

// 展示插屏广告
GrowthKit.showAd(with: .inserted)

// 展示开屏广告
GrowthKit.showAd(with: .appOpen)
```

### 带回调的展示

```swift
// 展示激励广告（带回调）
GrowthKit.showAd(with: .rewarded, callbacks: adCallbacks)
```

## 广告回调实现

### 回调协议

```swift
@objc protocol AdCallbacks {
    @objc optional func onStartLoading(_ style: ADStyle)      // 开始加载
    @objc optional func onLoadSuccess(_ style: ADStyle)       // 加载成功
    @objc optional func onLoadFailed(_ style: ADStyle, error: Error?)  // 加载失败
    @objc optional func onShowSuccess(_ style: ADStyle)       // 展示成功
    @objc optional func onShowFailed(_ style: ADStyle, error: Error?)  // 展示失败
    @objc optional func onGetAdReward(_ style: ADStyle)       // 获得激励
    @objc optional func onAdClick(_ style: ADStyle)           // 广告点击
    @objc optional func onAdClose(_ style: ADStyle)           // 广告关闭
}
```

### 完整实现示例

```swift
class AdManager: NSObject, AdCallbacks {
    
    func showRewardedAd() {
        GrowthKit.showAd(with: .rewarded, callbacks: self)
    }
    
    func showInterstitialAd() {
        GrowthKit.showAd(with: .inserted, callbacks: self)
    }
    
    func showAppOpenAd() {
        GrowthKit.showAd(with: .appOpen, callbacks: self)
    }
}

// MARK: - AdCallbacks
extension AdManager {
    
    func onStartLoading(_ style: ADStyle) {
        print("广告开始加载: \(style)")
        // 显示加载指示器
        showLoadingIndicator()
    }
    
    func onLoadSuccess(_ style: ADStyle) {
        print("广告加载成功: \(style)")
        // 隐藏加载指示器
        hideLoadingIndicator()
    }
    
    func onLoadFailed(_ style: ADStyle, error: Error?) {
        print("广告加载失败: \(style), 错误: \(error?.localizedDescription ?? "未知")")
        // 隐藏加载指示器
        hideLoadingIndicator()
        // 处理加载失败
        handleAdLoadFailure(style: style, error: error)
    }
    
    func onShowSuccess(_ style: ADStyle) {
        print("广告展示成功: \(style)")
        // 暂停游戏或应用
        pauseGame()
    }
    
    func onShowFailed(_ style: ADStyle, error: Error?) {
        print("广告展示失败: \(style), 错误: \(error?.localizedDescription ?? "未知")")
        // 处理展示失败
        handleAdShowFailure(style: style, error: error)
    }
    
    func onGetAdReward(_ style: ADStyle) {
        print("用户获得奖励: \(style)")
        // 发放游戏奖励
        giveReward()
    }
    
    func onAdClick(_ style: ADStyle) {
        print("广告被点击: \(style)")
        // 记录点击事件
        trackAdClick(style: style)
    }
    
    func onAdClose(_ style: ADStyle) {
        print("广告关闭: \(style)")
        // 恢复游戏
        resumeGame()
    }
    
    // MARK: - Helper Methods
    private func showLoadingIndicator() {
        // 显示加载指示器
    }
    
    private func hideLoadingIndicator() {
        // 隐藏加载指示器
    }
    
    private func pauseGame() {
        // 暂停游戏逻辑
    }
    
    private func resumeGame() {
        // 恢复游戏逻辑
    }
    
    private func giveReward() {
        // 发放奖励逻辑
    }
    
    private func trackAdClick(style: ADStyle) {
        // 记录点击事件
    }
    
    private func handleAdLoadFailure(style: ADStyle, error: Error?) {
        // 处理加载失败
    }
    
    private func handleAdShowFailure(style: ADStyle, error: Error?) {
        // 处理展示失败
    }
}
```

## 广告预加载

### 自动预加载

SDK 在初始化广告 SDK 后会自动进行广告预加载，通常无需手动调用预加载方法。

### 手动预加载方法（可选）

```swift
// 重新加载开屏广告
GrowthKit.shared.reloadAppOpenAd()

// 重新加载竞价广告
GrowthKit.shared.reloadBiddingAd()
```

### 何时需要手动预加载

仅在以下特殊情况下才需要手动调用预加载方法：

```swift
class AdPreloadManager {
    
    func preloadAds() {
        // 仅在需要强制刷新广告时调用
        GrowthKit.shared.reloadAppOpenAd()
        GrowthKit.shared.reloadBiddingAd()
    }
    
    func preloadOnAdClose() {
        // 广告展示后，如需立即预加载下一批广告
        preloadAds()
    }
    
    func preloadOnNetworkRecovery() {
        // 网络恢复后，重新预加载广告
        preloadAds()
    }
}
```

## 广告调试

### 调试工具

```swift
// 打开广告调试面板
GrowthKit.shared.showAdDebugger()

// 启用详细日志
GrowthKit.isLoggingEnabled = true
```

### 调试最佳实践

```swift
class AdDebugManager {
    
    func enableDebugMode() {
        // 启用调试模式
        GrowthKit.isLoggingEnabled = true
        
        // 在开发环境中启用调试面板
        #if DEBUG
        DispatchQueue.main.asyncAfter(deadline: .now() + 3.0) {
            GrowthKit.shared.showAdDebugger()
        }
        #endif
    }
    
    func logAdEvent(_ event: String, style: ADStyle) {
        #if DEBUG
        print("[AdDebug] \(event) - Style: \(style)")
        #endif
    }
}
```

## 错误处理

### 广告错误处理

```swift
extension AdManager {
    
    func handleAdError(_ error: Error?, style: ADStyle) {
        guard let error = error else { return }
        
        switch error {
        case let adError as AdError:
            switch adError {
            case .noFill:
                print("无广告填充: \(style)")
                handleNoFill(style: style)
            case .networkError:
                print("网络错误: \(style)")
                handleNetworkError(style: style)
            case .timeout:
                print("请求超时: \(style)")
                handleTimeout(style: style)
            }
        default:
            print("未知广告错误: \(error.localizedDescription)")
            handleUnknownError(error: error, style: style)
        }
    }
    
    private func handleNoFill(style: ADStyle) {
        // 处理无广告填充
        // 可以尝试其他广告网络或显示备用内容
    }
    
    private func handleNetworkError(style: ADStyle) {
        // 处理网络错误
        // 检查网络连接并重试
    }
    
    private func handleTimeout(style: ADStyle) {
        // 处理超时错误
        // 增加超时时间或使用备用策略
    }
    
    private func handleUnknownError(error: Error, style: ADStyle) {
        // 处理未知错误
        // 记录错误日志并报告
    }
}
```

## 最佳实践

### 1. 广告展示时机

- **激励广告**：在用户主动请求奖励时展示
- **插屏广告**：在游戏关卡结束或应用场景切换时展示
- **开屏广告**：在应用启动时展示

### 2. 用户体验优化

- 避免过于频繁的广告展示
- 提供跳过广告的选项（适用时）
- 确保广告加载时间合理

### 3. 错误处理

- 始终处理广告加载和展示失败的情况
- 提供备用内容或功能
- 记录详细的错误日志

### 4. 性能优化

- 预加载广告以提高响应速度
- 合理管理广告缓存
- 监控广告性能指标

### 5. 合规性

- 遵循各平台的广告政策
- 确保广告内容适合目标用户
- 正确处理用户隐私和数据

## 集成示例

### 游戏场景集成

```swift
class GameAdManager: AdManager {
    
    func showRewardAdForLevelComplete() {
        // 关卡完成时展示激励广告
        showRewardedAd()
    }
    
    func showInterstitialAdForLevelStart() {
        // 关卡开始时展示插屏广告
        showInterstitialAd()
    }
    
    override func onGetAdReward(_ style: ADStyle) {
        super.onGetAdReward(style)
        
        // 游戏特定的奖励逻辑
        if style == .rewarded {
            giveExtraLives()
            unlockSpecialItems()
        }
    }
    
    private func giveExtraLives() {
        // 给予额外生命
    }
    
    private func unlockSpecialItems() {
        // 解锁特殊道具
    }
}
```

## 相关文档

- [API 参考文档](API_参考文档.md) - 完整的 API 接口说明
- [错误处理指南](错误处理指南.md) - 错误码和处理方法
- [SDK 初始化指南](SDK_初始化指南.md) - 初始化配置

# 常见问题解答

## 概述

本文档收集了 GrowthSDK 使用过程中的常见问题和解决方案，帮助开发者快速解决遇到的问题。

## 集成相关问题

### Q1: 如何正确集成 GrowthSDK？

**A:** 请按照以下步骤进行集成：

1. **使用 CocoaPods 集成**（推荐）：
   ```ruby
   platform :ios, '14.0'
   use_frameworks!
   
   target 'YourAppTarget' do
     pod 'GrowthSDK', '~> 1.0.0'
   end
   ```

2. **配置必需权限**：
   - 在 `Info.plist` 中添加 HTTP 请求权限
   - 配置 App Tracking Transparency 权限
   - 添加 AdMob 应用标识
   - 配置 SKAdNetwork

3. **初始化 SDK**：
   ```swift
   let config = NetworkConfig(...)
   try await GrowthKit.shared.initialize(with: config)
   ```

详细步骤请参考 [SDK 集成指南](SDK_集成指南.md)。

### Q2: 编译时出现 "Always Embed Swift Standard Libraries" 错误怎么办？

**A:** 这是因为 Swift 标准库没有正确嵌入。解决方法：

1. 在 Xcode 中选择项目 Target
2. 进入 `Build Settings`
3. 搜索 "Always Embed Swift Standard Libraries"
4. 将其设置为 `Yes`

### Q3: 找不到 GrowthSDK 模块怎么办？

**A:** 可能的原因和解决方法：

1. **检查 CocoaPods 安装**：
   ```bash
   pod install
   ```
   确保使用 `.xcworkspace` 文件打开项目

2. **清理并重新构建**：
   - `Product → Clean Build Folder`
   - 重新构建项目

3. **检查 Target 设置**：
   - 确保在正确的 Target 中添加了依赖
   - 检查 `Frameworks, Libraries, and Embedded Content` 设置

## 初始化相关问题

### Q4: SDK 初始化失败怎么办？

**A:** 常见的初始化失败原因：

1. **配置参数错误**：
   - 检查 `serviceId`、`serviceUrl` 等参数是否正确
   - 确保所有必需参数都已提供

2. **网络连接问题**：
   - 检查网络连接是否正常
   - 确认服务器地址是否可访问

3. **权限配置问题**：
   - 确保 `Info.plist` 中配置了所有必需权限
   - 检查 AdMob App ID 是否正确

详细错误处理请参考 [错误处理指南](错误处理指南.md)。

### Q5: 如何检查 SDK 是否初始化成功？

**A:** 使用以下方法检查：

```swift
// 检查初始化状态
let isReady = GrowthKit.shared.isInitialized

// 检查当前状态
let state = GrowthKit.shared.state

// 获取版本信息
let version = GrowthKit.sdkVersion
```

### Q6: 可以重复初始化 SDK 吗？

**A:** 不建议重复初始化。如果尝试重复初始化，会抛出 `InitError.alreadyInitialized` 错误。建议在应用启动时只初始化一次。

## 广告相关问题

### Q7: 广告加载失败怎么办？

**A:** 广告加载失败的常见原因：

1. **SDK 未初始化**：
   - 确保在展示广告前 SDK 已正确初始化

2. **网络问题**：
   - 检查网络连接
   - 确认防火墙设置

3. **广告配置问题**：
   - 检查广告单元 ID 是否正确
   - 确认广告网络配置

4. **无广告填充**：
   - 这是正常现象，可以尝试其他广告网络
   - 实现降级策略

### Q8: 如何实现广告预加载？

**A:** 使用以下 API 进行预加载：

```swift
// 预加载开屏广告
GrowthKit.shared.reloadAppOpenAd()

// 预加载竞价广告
GrowthKit.shared.reloadBiddingAd()
```

建议在应用启动后延迟几秒进行预加载，避免影响启动性能。

### Q9: 广告回调没有触发怎么办？

**A:** 检查以下几点：

1. **确保实现了回调协议**：
   ```swift
   class AdManager: NSObject, AdCallbacks {
       // 实现回调方法
   }
   ```

2. **检查回调对象生命周期**：
   - 确保回调对象没有被释放
   - 使用强引用持有回调对象

3. **验证回调设置**：
   ```swift
   GrowthKit.showAd(with: .rewarded, callbacks: self)
   ```

### Q10: 如何调试广告问题？

**A:** 使用以下调试工具：

```swift
// 启用详细日志
GrowthKit.isLoggingEnabled = true

// 打开广告调试面板
GrowthKit.shared.showAdDebugger()
```

在开发环境中启用调试模式，查看详细的日志信息。

## 权限相关问题

### Q11: IDFA 获取失败怎么办？

**A:** IDFA 获取失败的处理方法：

1. **确保配置了权限描述**：
   ```xml
   <key>NSUserTrackingUsageDescription</key>
   <string>我们会使用您的设备标识用于投放优化与归因分析。</string>
   ```

2. **在合适时机请求权限**：
   ```swift
   import AppTrackingTransparency
   
   if #available(iOS 14.5, *) {
       ATTrackingManager.requestTrackingAuthorization { status in
           // 处理授权结果
       }
   }
   ```

3. **处理未授权情况**：
   - 未授权时广告个性化功能可能受限
   - 实现降级策略

### Q12: 网络权限配置问题

**A:** 确保在 `Info.plist` 中正确配置网络权限：

```xml
<key>NSAppTransportSecurity</key>
<dict>
  <key>NSAllowsArbitraryLoads</key>
  <true/>
</dict>
```

## 性能相关问题

### Q13: SDK 影响应用启动速度怎么办？

**A:** 优化启动性能的方法：

1. **异步初始化**：
   ```swift
   Task {
       try await GrowthKit.shared.initialize(with: config)
   }
   ```

2. **延迟预加载**：
   ```swift
   DispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {
       // 预加载广告
   }
   ```

3. **后台初始化**：
   - 在应用启动后立即开始初始化
   - 避免阻塞主线程

### Q14: 内存使用过高怎么办？

**A:** 内存优化建议：

1. **及时释放资源**：
   - 广告展示完成后及时清理
   - 避免持有不必要的强引用

2. **合理使用缓存**：
   - 控制广告缓存数量
   - 定期清理过期缓存

3. **监控内存使用**：
   - 使用 Xcode 的 Instruments 工具监控
   - 及时发现内存泄漏

## Unity 集成问题

### Q15: Unity 集成时视图显示异常怎么办？

**A:** Unity 集成常见问题：

1. **视图控制器配置**：
   ```swift
   let sdkController = GrowthKit.createController(with: unityController)
   ```

2. **视图层次结构**：
   - 确保 Unity 视图控制器正确设置
   - 检查视图层次结构

3. **生命周期管理**：
   - 正确管理视图控制器的生命周期
   - 避免内存泄漏

### Q16: Unity 项目编译失败

**A:** 检查以下配置：

1. **框架链接**：
   - 确保 `UnityFramework.framework` 正确链接
   - 设置为 "Embed & Sign"

2. **架构设置**：
   - 确保支持相同的架构（arm64、x86_64）
   - 检查部署目标设置

## 版本兼容性问题

### Q17: 支持的最低 iOS 版本是多少？

**A:** GrowthSDK 支持 iOS 14.0 及以上版本。

### Q18: 如何升级 SDK 版本？

**A:** 升级步骤：

1. **更新 Podfile**：
   ```ruby
   pod 'GrowthSDK', '~> 1.0.0'  # 更新到新版本
   ```

2. **更新依赖**：
   ```bash
   pod update GrowthSDK
   ```

3. **检查兼容性**：
   - 查看更新日志
   - 测试现有功能

### Q19: 如何处理 API 变更？

**A:** 应对 API 变更：

1. **查看迁移指南**：
   - 阅读版本更新说明
   - 按照迁移步骤进行更新

2. **逐步迁移**：
   - 先更新到兼容版本
   - 逐步使用新 API

3. **充分测试**：
   - 测试所有相关功能
   - 确保兼容性

## 调试和日志问题

### Q20: 如何启用详细日志？

**A:** 启用日志的方法：

```swift
// 启用 SDK 日志
GrowthKit.isLoggingEnabled = true

// 在开发环境中启用调试面板
#if DEBUG
GrowthKit.shared.showAdDebugger()
#endif
```

### Q21: 日志信息不够详细怎么办？

**A:** 获取更详细信息的方法：

1. **使用调试面板**：
   - 查看实时状态信息
   - 监控网络请求

2. **添加自定义日志**：
   ```swift
   print("自定义日志: \(debugInfo)")
   ```

3. **使用第三方日志工具**：
   - 集成专业的日志框架
   - 实现远程日志收集

## 网络相关问题

### Q22: 网络请求超时怎么办？

**A:** 处理网络超时：

1. **增加超时时间**：
   - 在网络配置中设置更长的超时时间
   - 实现重试机制

2. **网络状态检查**：
   ```swift
   // 检查网络连接
   // 检查网络可用性（示例逻辑，具体可结合业务实现）
   let networkOK = true
   ```

3. **降级策略**：
   - 网络不可用时使用本地缓存
   - 提供离线功能

### Q23: 服务器返回错误怎么办？

**A:** 服务器错误处理：

1. **错误码解析**：
   - 根据错误码进行相应处理
   - 实现错误恢复机制

2. **重试策略**：
   - 实现指数退避重试
   - 避免频繁重试

3. **用户提示**：
   - 显示友好的错误信息
   - 提供重试选项

## 安全和隐私问题

### Q24: 如何处理用户隐私？

**A:** 隐私保护措施：

1. **数据最小化**：
   - 只收集必要的数据
   - 及时删除不需要的数据

2. **用户同意**：
   - 明确告知数据使用目的
   - 获得用户明确同意

3. **数据安全**：
   - 使用加密传输
   - 安全存储敏感数据

### Q25: 如何确保数据安全？

**A:** 数据安全措施：

1. **传输安全**：
   - 使用 HTTPS 协议
   - 实现证书固定

2. **存储安全**：
   - 使用 Keychain 存储敏感数据
   - 实现数据加密

3. **访问控制**：
   - 限制数据访问权限
   - 实现审计日志

## 联系支持

### Q26: 遇到无法解决的问题怎么办？

**A:** 获取帮助的渠道：

1. **查看文档**：
   - 仔细阅读相关文档
   - 查看示例代码

2. **搜索问题**：
   - 在 GitHub Issues 中搜索类似问题
   - 查看社区讨论

3. **联系支持**：
   - 发送邮件到 [shugedeveloper@163.com](mailto:shugedeveloper@163.com)
   - 在 GitHub 上提交 Issue

4. **提供信息**：
   - 详细描述问题现象
   - 提供错误日志和复现步骤
   - 包含设备和系统信息

## 相关文档

- [SDK 集成指南](SDK_集成指南.md) - 详细的集成步骤
- [SDK 初始化指南](SDK_初始化指南.md) - 初始化配置和示例
- [广告集成指南](广告集成指南.md) - 广告功能集成
- [错误处理指南](错误处理指南.md) - 错误码和处理方法
- [API 参考文档](API_参考文档.md) - 完整的 API 接口
